{"ast":null,"code":"import _objectSpread from\"C:/Users/YeisonDuqueDiaz/AppData/Roaming/npm/node_modules/react-scripts/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _objectWithoutProperties from\"C:/Users/YeisonDuqueDiaz/AppData/Roaming/npm/node_modules/react-scripts/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties.js\";const _excluded=[\"project_code\"];// FormularioHoras.tsx\n/// <reference types=\"react\" />\n/// <reference types=\"react-dom\" />\nimport React,{useState,useEffect,useCallback,useMemo,useRef}from'react';import{format,parseISO}from'date-fns';import{es}from'date-fns/locale';import Header from'./Header';import{toast,Toaster}from'sonner';import{Calendar as CalendarIcon,Briefcase,Save,Pencil,ListChecks,ClipboardList,XCircle,PlusCircle,Loader2,Folder,Star,Minus,Plus,Info,Undo2,Clock}from'lucide-react';import{Card,CardContent,CardHeader,CardTitle}from'./ui/card';import{Button}from'./ui/button';import{Input}from'./ui/input';import{Calendar}from'./ui/calendar';import{Popover,PopoverContent,PopoverTrigger}from'./ui/popover';import{cn}from'../lib/utils';import{Dialog,DialogContent,DialogHeader,DialogTitle,DialogDescription}from'./ui/dialog';import{FormSelect}from'./formulario/FormSelect';import{ActivityItem}from'./formulario/ActivityItem';import{ActivityListSkeleton}from'./formulario/ActivityListSkeleton';import{EmptyState}from'./formulario/EmptyState';import{TotalHoursProgress}from'./formulario/TotalHoursProgress';import TablaHoras from'./TablaHoras';import{submitHours,getProjects,getProjectStages,getDisciplinesByStage,getActivitiesByDiscipline,getDailyActivities,deleteHour,updateHour}from'../api/horasApi';// Props e interfaces\nimport{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const initialFormData=employeeId=>({employee_id:String(employeeId),project_code:'',phase:'',discipline:'',activity:'',hours:'0',note:''});const DRAFT_KEY='fh_form_draft_v1';// Helper: ordenar A-Z / 0-9\nconst sortAZ=arr=>[...arr].sort((a,b)=>a.localeCompare(b,'es',{numeric:true,sensitivity:'base'}));// Comparator: primero letras, luego números\nconst projectComparator=(a,b)=>{var _a$code,_b$code;const aCode=((_a$code=a.code)!==null&&_a$code!==void 0?_a$code:'').trim();const bCode=((_b$code=b.code)!==null&&_b$code!==void 0?_b$code:'').trim();const aStartsWithLetter=/^[A-Za-zÁÉÍÓÚÜÑ]/i.test(aCode);const bStartsWithLetter=/^[A-Za-zÁÉÍÓÚÜÑ]/i.test(bCode);if(aStartsWithLetter!==bStartsWithLetter)return aStartsWithLetter?-1:1;// dentro del mismo grupo, ordenar natural A-Z/0-9\nreturn aCode.localeCompare(bCode,'es',{numeric:true,sensitivity:'base'});};const FormularioHoras=_ref=>{let{onSuccess,employeeId,employeeName,onLogout,onShowPowerBI}=_ref;const[formData,setFormData]=useState(initialFormData(employeeId));const[selectedDate,setSelectedDate]=useState(new Date());const[dailyActivities,setDailyActivities]=useState([]);const[projects,setProjects]=useState([]);const[stages,setStages]=useState([]);const[disciplines,setDisciplines]=useState([]);const[activities,setActivities]=useState([]);const[editingActivityId,setEditingActivityId]=useState(null);const FAV_KEY=useMemo(()=>\"fh_favorites_v1_\".concat(employeeId),[employeeId]);const[favorites,setFavorites]=useState([]);const[sortDir,setSortDir]=useState('asc');const[isTableModalOpen,setIsTableModalOpen]=useState(false);const[isTableVisible,setIsTableVisible]=useState(false);const[isHoveringTableButton,setIsHoveringTableButton]=useState(false);const[isDirty,setIsDirty]=useState(false);const[loading,setLoading]=useState({submit:false,projects:true,stages:false,disciplines:false,activities:false,dailyActivities:true,delete:null});const hoursInputRef=useRef(null);const undoTimerRef=useRef(null);const favScrollRef=useRef(null);const handleFavWheel=useCallback(e=>{if(Math.abs(e.deltaY)>Math.abs(e.deltaX)){e.preventDefault();e.stopPropagation();e.currentTarget.scrollLeft+=e.deltaY;}},[]);const selectedProjectName=useMemo(()=>{var _projects$find;return((_projects$find=projects.find(p=>p.code===formData.project_code))===null||_projects$find===void 0?void 0:_projects$find.name)||'';},[formData.project_code,projects]);const hoursNumber=useMemo(()=>{var _formData$hours;const raw=String((_formData$hours=formData.hours)!==null&&_formData$hours!==void 0?_formData$hours:'').replace(',','.').trim();const n=Number(raw);return Number.isFinite(n)?n:0;},[formData.hours]);const totalHoursToday=useMemo(()=>dailyActivities.reduce((sum,a)=>sum+(Number(a.hours)||0),0),[dailyActivities]);const[errors,setErrors]=useState({});useEffect(()=>{const newErrors={};if(!formData.project_code)newErrors.project_code='Selecciona un proyecto';if(!formData.phase)newErrors.phase='Selecciona una etapa';if(!formData.discipline)newErrors.discipline='Selecciona una disciplina';if(!formData.activity)newErrors.activity='Selecciona una actividad';if(!(hoursNumber>0))newErrors.hours='Ingresa horas válidas (> 0)';setErrors(newErrors);},[formData,hoursNumber]);useEffect(()=>{const raw=localStorage.getItem(DRAFT_KEY);if(raw){try{const draft=JSON.parse(raw);// Restore form data but keep project_code empty to ensure it's cleared on page refresh\nconst{project_code}=draft,draftWithoutProjectCode=_objectWithoutProperties(draft,_excluded);setFormData(prev=>_objectSpread(_objectSpread(_objectSpread({},prev),draftWithoutProjectCode),{},{project_code:'',// Always initialize project_code as empty\nemployee_id:String(employeeId)}));}catch(_unused){}}},[employeeId]);useEffect(()=>{localStorage.setItem(DRAFT_KEY,JSON.stringify(formData));},[formData]);useEffect(()=>{const raw=localStorage.getItem(FAV_KEY);if(raw)try{setFavorites(JSON.parse(raw));}catch(_unused2){}},[FAV_KEY]);const saveFavorites=next=>{setFavorites(next);localStorage.setItem(FAV_KEY,JSON.stringify(next));};const currentFavObj=useMemo(()=>{if(!formData.project_code||!formData.phase||!formData.discipline||!formData.activity)return null;return{project_code:formData.project_code,phase:formData.phase,discipline:formData.discipline,activity:formData.activity};},[formData.project_code,formData.phase,formData.discipline,formData.activity]);const isCurrentFavorite=useMemo(()=>{if(!currentFavObj)return false;return favorites.some(f=>JSON.stringify(f)===JSON.stringify(currentFavObj));},[favorites,currentFavObj]);const toggleFavorite=()=>{if(!currentFavObj){toast.error('Completa Proyecto, Etapa, Disciplina y Actividad para usar favoritos');return;}if(isCurrentFavorite){const next=favorites.filter(f=>JSON.stringify(f)!==JSON.stringify(currentFavObj));saveFavorites(next);toast.message('Eliminado de favoritos');}else{saveFavorites([...favorites,currentFavObj]);toast.success('Guardado en favoritos');}};const visibleActivities=useMemo(()=>{let list=[...dailyActivities];list.sort((a,b)=>(a.id||'').localeCompare(b.id||''));if(sortDir==='desc')list.reverse();return list;},[dailyActivities,sortDir]);useEffect(()=>{const base=initialFormData(employeeId);const changed=JSON.stringify(_objectSpread(_objectSpread({},formData),{},{employee_id:undefined}))!==JSON.stringify(_objectSpread(_objectSpread({},base),{},{employee_id:undefined}));setIsDirty(changed||Boolean(editingActivityId));},[formData,editingActivityId,employeeId]);const refreshDailyActivities=useCallback(async(date,id)=>{setLoading(p=>_objectSpread(_objectSpread({},p),{},{dailyActivities:true}));try{const dateString=format(date,'yyyy-MM-dd');const acts=await getDailyActivities(dateString,Number(id));setDailyActivities(acts);}catch(e){toast.error('Error al cargar las actividades del día.');console.error(e);}finally{setLoading(p=>_objectSpread(_objectSpread({},p),{},{dailyActivities:false}));}},[]);const fetchProjects=useCallback(async()=>{setLoading(p=>_objectSpread(_objectSpread({},p),{},{projects:true}));try{const data=await getProjects();const sorted=[...data].sort(projectComparator);// letras primero, luego números\nsetProjects(sorted);}catch(e){toast.error('Error al cargar proyectos.');}finally{setLoading(p=>_objectSpread(_objectSpread({},p),{},{projects:false}));}},[]);const fetchStages=useCallback(async projectCode=>{if(!projectCode)return[];setLoading(p=>_objectSpread(_objectSpread({},p),{},{stages:true}));try{const data=await getProjectStages(projectCode);const cleaned=(data||[]).filter(v=>v!=null&&String(v).trim()!=='').map(String);const sorted=sortAZ(cleaned);setStages(sorted);return sorted;}catch(e){toast.error('Error al cargar etapas.');setStages([]);return[];}finally{setLoading(p=>_objectSpread(_objectSpread({},p),{},{stages:false}));}},[]);const fetchDisciplines=useCallback(async(projectCode,stage)=>{if(!projectCode||!stage)return[];setLoading(p=>_objectSpread(_objectSpread({},p),{},{disciplines:true}));try{const data=await getDisciplinesByStage(projectCode,stage);const cleaned=(data||[]).filter(v=>v!=null&&String(v).trim()!=='').map(String);const sorted=sortAZ(cleaned);setDisciplines(sorted);return sorted;}catch(e){toast.error('Error al cargar disciplinas.');setDisciplines([]);return[];}finally{setLoading(p=>_objectSpread(_objectSpread({},p),{},{disciplines:false}));}},[]);const fetchActivities=useCallback(async(projectCode,stage,discipline)=>{if(!projectCode||!stage||!discipline)return[];setLoading(p=>_objectSpread(_objectSpread({},p),{},{activities:true}));try{const data=await getActivitiesByDiscipline(projectCode,stage,discipline);const cleaned=(data||[]).filter(v=>v!=null&&String(v).trim()!=='').map(String);const sorted=sortAZ(cleaned);setActivities(sorted);return sorted;}catch(e){toast.error('Error al cargar actividades.');setActivities([]);return[];}finally{setLoading(p=>_objectSpread(_objectSpread({},p),{},{activities:false}));}},[]);const applyFavorite=useCallback(async fav=>{try{setFormData(prev=>_objectSpread(_objectSpread({},prev),{},{project_code:fav.project_code,phase:'',discipline:'',activity:''}));const st=await fetchStages(fav.project_code);if(st&&st.includes(fav.phase)){const ds=await fetchDisciplines(fav.project_code,fav.phase);if(ds&&ds.includes(fav.discipline)){const ac=await fetchActivities(fav.project_code,fav.phase,fav.discipline);if(ac&&ac.includes(fav.activity)){setFormData({employee_id:String(employeeId),project_code:fav.project_code,phase:fav.phase,discipline:fav.discipline,activity:fav.activity,hours:'0',note:''});}}}}catch(e){console.error(e);toast.error('No se pudo aplicar el favorito');}},[employeeId,fetchStages,fetchDisciplines,fetchActivities]);useEffect(()=>{fetchProjects();},[fetchProjects]);useEffect(()=>{refreshDailyActivities(selectedDate,String(employeeId));},[selectedDate,employeeId,refreshDailyActivities]);const handleDateChange=date=>{if(date)setSelectedDate(date);};const handleChange=e=>{const{name,value}=e.target;const v=name==='hours'?value.replace(',','.'):value;setFormData(prev=>_objectSpread(_objectSpread({},prev),{},{[name]:v}));};const handleNoteKeyDown=e=>{if(e.key==='Enter'&&!e.shiftKey)e.preventDefault();};const handleSelectChange=async(name,value)=>{const updated=_objectSpread(_objectSpread({},formData),{},{[name]:value});switch(name){case'project_code':updated.phase='';updated.discipline='';updated.activity='';setFormData(updated);setStages([]);setDisciplines([]);setActivities([]);if(value)await fetchStages(value);break;case'phase':updated.discipline='';updated.activity='';setFormData(updated);setDisciplines([]);setActivities([]);if(value&&updated.project_code)await fetchDisciplines(updated.project_code,value);break;case'discipline':updated.activity='';setFormData(updated);setActivities([]);if(value&&updated.project_code&&updated.phase)await fetchActivities(updated.project_code,updated.phase,value);break;default:setFormData(updated);}};const resetForm=useCallback(()=>{setFormData(initialFormData(employeeId));setEditingActivityId(null);},[employeeId]);const handleEditActivity=useCallback(async activity=>{try{var _activity$hours;if(activity.date){try{const d=typeof activity.date==='string'?parseISO(activity.date):new Date(activity.date);setSelectedDate(d);}catch(_unused3){}}if(activity.project_code){await fetchStages(activity.project_code);if(activity.phase)await fetchDisciplines(activity.project_code,activity.phase);if(activity.phase&&activity.discipline)await fetchActivities(activity.project_code,activity.phase,activity.discipline);}setFormData({employee_id:String(employeeId),project_code:activity.project_code||'',phase:activity.phase||'',discipline:activity.discipline||'',activity:activity.activity||'',hours:String((_activity$hours=activity.hours)!==null&&_activity$hours!==void 0?_activity$hours:'0'),note:activity.note||''});setEditingActivityId(String(activity.id));window.scrollTo({top:0,behavior:'smooth'});}catch(e){console.error(e);toast.error('Error al cargar la actividad para edición');}},[employeeId,fetchStages,fetchDisciplines,fetchActivities]);const[undoData,setUndoData]=useState(null);const triggerUndoBanner=activity=>{setUndoData(activity);if(undoTimerRef.current)clearTimeout(undoTimerRef.current);undoTimerRef.current=setTimeout(()=>setUndoData(null),8000);};const handleUndoDelete=async()=>{if(!undoData)return;const a=undoData;setUndoData(null);try{await submitHours({project_code:a.project_code,phase:a.phase,discipline:a.discipline,activity:a.activity,hours:a.hours,note:a.note||'',date:format(selectedDate,'yyyy-MM-dd'),employee_id:employeeId});await refreshDailyActivities(selectedDate,String(employeeId));toast.success('Registro restaurado');}catch(e){toast.error('No se pudo restaurar');}};const coreSubmit=async()=>{const submissionData={project_code:formData.project_code,phase:formData.phase,discipline:formData.discipline,activity:formData.activity,hours:hoursNumber,note:formData.note||'',date:format(selectedDate,'yyyy-MM-dd'),employee_id:employeeId};const toastId=toast.loading(editingActivityId?'Actualizando actividad...':'Guardando actividad...');setLoading(p=>_objectSpread(_objectSpread({},p),{},{submit:true}));try{if(editingActivityId){await updateHour(editingActivityId,submissionData);}else{await submitHours(submissionData);}toast.success(\"Actividad \".concat(editingActivityId?'actualizada':'guardada',\" con \\xE9xito.\"),{id:toastId,duration:1800});await refreshDailyActivities(selectedDate,String(employeeId));onSuccess===null||onSuccess===void 0?void 0:onSuccess();return true;}catch(e){console.error(e);toast.error('Ocurrió un error al guardar.',{id:toastId});return false;}finally{setLoading(p=>_objectSpread(_objectSpread({},p),{},{submit:false}));}};const handleSubmit=async e=>{e.preventDefault();if(Object.keys(errors).length){toast.error('Revisa los campos marcados');return;}const ok=await coreSubmit();if(ok)resetForm();};const handleDelete=async id=>{const prev=dailyActivities.find(a=>String(a.id)===String(id));try{setLoading(p=>_objectSpread(_objectSpread({},p),{},{delete:id}));await deleteHour(id);await refreshDailyActivities(selectedDate,String(employeeId));if(prev)triggerUndoBanner(prev);toast.error('Actividad eliminada');}catch(e){console.error(e);toast.error('No se pudo eliminar');}finally{setLoading(p=>_objectSpread(_objectSpread({},p),{},{delete:null}));}};const adjustHours=delta=>{const current=hoursNumber||0;const next=Math.max(0,Math.round((current+delta)*2)/2);setFormData(prev=>_objectSpread(_objectSpread({},prev),{},{hours:String(next)}));};useEffect(()=>{const onKey=e=>{if((e.ctrlKey||e.metaKey)&&e.key.toLowerCase()==='enter'){e.preventDefault();(async()=>{if(!loading.submit){const ok=await coreSubmit();if(ok)resetForm();}})();}if(e.key==='Escape'){resetForm();}};window.addEventListener('keydown',onKey);return()=>window.removeEventListener('keydown',onKey);},[coreSubmit,loading.submit,resetForm]);// Navegar a la vista de permisos\nconst handleNavigateToPermissions=()=>{// La lógica de navegación se maneja en App.tsx\n};// Navegar a la vista de horas\nconst handleNavigateToHours=()=>{// La lógica de navegación se maneja en App.tsx\n};return/*#__PURE__*/_jsxs(\"div\",{className:\"min-h-screen bg-[#f2f6fd] text-foreground\",children:[/*#__PURE__*/_jsx(Toaster,{position:\"top-right\",richColors:true}),/*#__PURE__*/_jsx(Header,{employeeName:employeeName,onLogout:onLogout,onShowPowerBI:onShowPowerBI,onNavigateToHours:handleNavigateToHours,onNavigateToPermissions:handleNavigateToPermissions,currentView:\"hours\"}),/*#__PURE__*/_jsx(\"style\",{children:\"\\n        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }\\n        .hide-scrollbar::-webkit-scrollbar { display: none; }\\n        .fav-strip { overscroll-behavior-y: contain; touch-action: pan-x; }\\n\\n        /* \\uD83D\\uDC49 Fuerza saltos de l\\xEDnea en textos sin espacios y evita desbordes */\\n        .text-wrap, .text-wrap *{\\n          overflow-wrap: anywhere;\\n          word-break: break-word;\\n          hyphens: auto;\\n        }\\n      \"}),/*#__PURE__*/_jsx(\"div\",{className:\"mx-auto container p-4 sm:p-6 lg:p-8\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 lg:grid-cols-5 gap-8 items-start\",children:[/*#__PURE__*/_jsx(\"main\",{className:cn('lg:col-span-3'),children:/*#__PURE__*/_jsxs(Card,{className:\"relative z-10 flex flex-col text-wrap\",children:[/*#__PURE__*/_jsxs(CardHeader,{className:\"relative items-center text-center\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-center gap-2\",children:[editingActivityId?/*#__PURE__*/_jsx(Pencil,{className:\"h-5 w-5\"}):/*#__PURE__*/_jsx(PlusCircle,{className:\"h-5 w-5\"}),/*#__PURE__*/_jsx(CardTitle,{className:\"text-center\",children:editingActivityId?'Editar Actividad':'Registrar Actividad'})]}),/*#__PURE__*/_jsx(\"div\",{className:\"absolute right-4 top-4 text-xs\",children:editingActivityId?/*#__PURE__*/_jsx(\"span\",{className:\"px-2 py-1 rounded-full bg-amber-100 text-amber-800\",children:\"Editando\"}):/*#__PURE__*/_jsx(\"span\",{className:\"px-2 py-1 rounded-full bg-emerald-100 text-emerald-700\",children:\"Creando\"})}),/*#__PURE__*/_jsx(\"p\",{className:\"mt-2 text-sm text-muted-foreground\",children:\"Registra tus horas del d\\xEDa para el proyecto seleccionado.\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-3 text-xs sm:text-sm text-foreground/80 flex-wrap justify-center gap-2\",children:[/*#__PURE__*/_jsxs(\"span\",{className:\"inline-flex items-center gap-1 px-2 py-1 rounded-full bg-white border\",children:[/*#__PURE__*/_jsx(Briefcase,{className:\"h-3.5 w-3.5\"}),\" \",formData.project_code||'—']}),/*#__PURE__*/_jsxs(\"span\",{className:\"inline-flex items-center gap-1 px-2 py-1 rounded-full bg-white border\",children:[/*#__PURE__*/_jsx(ListChecks,{className:\"h-3.5 w-3.5\"}),\" \",formData.phase||'—']}),/*#__PURE__*/_jsxs(\"span\",{className:\"inline-flex items-center gap-1 px-2 py-1 rounded-full bg-white border\",children:[/*#__PURE__*/_jsx(Pencil,{className:\"h-3.5 w-3.5\"}),\" \",formData.discipline||'—']}),/*#__PURE__*/_jsxs(\"span\",{className:\"inline-flex items-center gap-1 px-2 py-1 rounded-full bg-white border\",children:[/*#__PURE__*/_jsx(ClipboardList,{className:\"h-3.5 w-3.5\"}),\" \",formData.activity||'—']})]})]}),/*#__PURE__*/_jsxs(CardContent,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"mb-4 w-full sm:max-w-xs\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-foreground/80 mb-1\",children:/*#__PURE__*/_jsxs(\"span\",{className:\"inline-flex items-center gap-1\",children:[/*#__PURE__*/_jsx(CalendarIcon,{className:\"h-4 w-4\"}),\" Fecha\"]})}),/*#__PURE__*/_jsxs(Popover,{children:[/*#__PURE__*/_jsx(PopoverTrigger,{asChild:true,children:/*#__PURE__*/_jsx(Button,{variant:\"outline\",className:cn('w-full justify-start font-normal h-10',!selectedDate&&'text-muted-foreground'),children:/*#__PURE__*/_jsx(\"span\",{children:format(selectedDate,'PPP',{locale:es})})})}),/*#__PURE__*/_jsx(PopoverContent,{className:\"w-auto p-0\",align:\"start\",children:/*#__PURE__*/_jsx(Calendar,{mode:\"single\",selected:selectedDate,onSelect:handleDateChange,initialFocus:true,locale:es})})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-[320px_minmax(0,1fr)] gap-6 items-start\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"text-wrap\",children:[/*#__PURE__*/_jsx(FormSelect,{label:\"C\\xF3digo de Proyecto\",name:\"project_code\",value:formData.project_code,onValueChange:handleSelectChange,options:projects.map(p=>({value:p.code,label:p.code,dropdownLabel:\"\".concat(p.code,\" - \").concat(p.name)})),placeholder:\"Seleccione un proyecto\",loading:loading.projects,disabled:loading.projects,icon:/*#__PURE__*/_jsx(Briefcase,{className:\"h-4 w-4\"}),required:true}),/*#__PURE__*/_jsx(\"p\",{className:\"mt-1 text-[12px] text-muted-foreground whitespace-nowrap overflow-hidden text-ellipsis leading-none\",children:\"Elige el proyecto para cargar los demas campos.\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-2 text-wrap\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-foreground/80 mb-1\",children:/*#__PURE__*/_jsxs(\"span\",{className:\"inline-flex items-center gap-1\",children:[/*#__PURE__*/_jsx(Folder,{className:\"h-4 w-4\"}),\" Nombre del Proyecto\"]})}),/*#__PURE__*/_jsx(Input,{value:selectedProjectName,readOnly:true,className:\"bg-muted/50\",\"aria-label\":\"Nombre de proyecto seleccionado\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-wrap\",children:[/*#__PURE__*/_jsx(FormSelect,{label:\"Etapa\",name:\"phase\",value:formData.phase,onValueChange:handleSelectChange,options:stages.map(s=>({value:s,label:s})),placeholder:\"Seleccione una etapa\",loading:loading.stages,disabled:!formData.project_code||loading.stages,icon:/*#__PURE__*/_jsx(ListChecks,{className:\"h-4 w-4\"}),required:true}),/*#__PURE__*/_jsx(\"p\",{className:\"mt-1 text-xs text-muted-foreground\",children:\"Etapas disponibles para el proyecto elegido.\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-wrap\",children:[/*#__PURE__*/_jsx(FormSelect,{label:\"Disciplina\",name:\"discipline\",value:formData.discipline,onValueChange:handleSelectChange,options:disciplines.map(d=>({value:d,label:d})),placeholder:\"Seleccione una disciplina\",loading:loading.disciplines,disabled:!formData.phase||loading.disciplines,icon:/*#__PURE__*/_jsx(Pencil,{className:\"h-4 w-4\"}),required:true}),/*#__PURE__*/_jsx(\"p\",{className:\"mt-1 text-xs text-muted-foreground\",children:\"Se filtran seg\\xFAn la etapa seleccionada.\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"w-full md:w-[320px] text-wrap\",children:/*#__PURE__*/_jsx(FormSelect,{label:\"Actividad\",name:\"activity\",value:formData.activity,onValueChange:handleSelectChange,options:activities.map(a=>({value:a,label:a})),placeholder:\"Seleccione una actividad\",loading:loading.activities,disabled:!formData.discipline||loading.activities,icon:/*#__PURE__*/_jsx(ClipboardList,{className:\"h-4 w-4\"}),required:true})}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col text-wrap\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"hours\",className:\"block text-sm font-medium text-foreground/80 mb-1\",children:/*#__PURE__*/_jsxs(\"span\",{className:\"inline-flex items-center gap-1\",children:[/*#__PURE__*/_jsx(Clock,{className:\"h-4 w-4\"}),\" Horas \",/*#__PURE__*/_jsx(\"span\",{className:\"text-destructive\",children:\"*\"})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-1\",children:[/*#__PURE__*/_jsx(Button,{type:\"button\",variant:\"outline\",size:\"icon\",className:\"h-10 w-10 shrink-0\",onClick:()=>adjustHours(-0.5),\"aria-label\":\"Restar 0.5h\",children:/*#__PURE__*/_jsx(Minus,{className:\"h-4 w-4\"})}),/*#__PURE__*/_jsx(Button,{type:\"button\",variant:\"outline\",size:\"icon\",className:\"h-10 w-10 shrink-0\",onClick:()=>adjustHours(0.5),\"aria-label\":\"Sumar 0.5h\",children:/*#__PURE__*/_jsx(Plus,{className:\"h-4 w-4\"})}),/*#__PURE__*/_jsx(Input,{id:\"hours\",name:\"hours\",type:\"number\",value:formData.hours,onChange:handleChange,min:\"0\",step:\"0.5\",ref:hoursInputRef,className:\"h-10 w-[100px] shrink-0 rounded-md mr-0\"}),/*#__PURE__*/_jsxs(Button,{type:\"button\",variant:isCurrentFavorite?'default':'outline',className:\"h-10 shrink-0\",onClick:toggleFavorite,title:isCurrentFavorite?'Quitar de favoritos':'Guardar como favorito',children:[/*#__PURE__*/_jsx(Star,{className:\"h-4 w-4 mr-2\"}),\" Favorito\"]})]})]}),favorites.length>0&&/*#__PURE__*/_jsx(\"div\",{className:\"md:col-span-2\",children:/*#__PURE__*/_jsx(\"div\",{ref:favScrollRef,onWheel:handleFavWheel,className:\"mt-1 overflow-x-auto whitespace-nowrap hide-scrollbar fav-strip\",style:{overscrollBehaviorX:'contain',overscrollBehaviorY:'none',touchAction:'pan-x'},children:/*#__PURE__*/_jsx(\"div\",{className:\"flex gap-2\",children:favorites.map((fav,idx)=>/*#__PURE__*/_jsxs(\"button\",{type:\"button\",onClick:()=>applyFavorite(fav),className:\"inline-flex items-center gap-2 px-3 py-1 rounded-full border bg-white hover:bg-muted text-xs shrink-0\",title:\"\".concat(fav.project_code,\" \\u2022 \").concat(fav.phase,\" \\u2022 \").concat(fav.discipline),children:[/*#__PURE__*/_jsx(Star,{className:\"h-3.5 w-3.5\"}),/*#__PURE__*/_jsx(\"span\",{className:\"font-medium\",children:fav.activity})]},idx))})})}),/*#__PURE__*/_jsxs(\"div\",{className:\"md:col-span-2 w-full text-wrap\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"note\",className:\"block text-sm font-medium text-foreground/80 mb-1\",children:/*#__PURE__*/_jsxs(\"span\",{className:\"inline-flex items-center gap-1\",children:[/*#__PURE__*/_jsx(Info,{className:\"h-4 w-4\"}),\" Nota (Opcional)\"]})}),/*#__PURE__*/_jsx(\"textarea\",{id:\"note\",name:\"note\",value:formData.note,onChange:handleChange,onKeyDown:handleNoteKeyDown,rows:2,className:\"flex h-19 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 whitespace-pre-wrap\",placeholder:\"Descripci\\xF3n breve del trabajo realizado\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-6 flex items-center justify-end gap-3\",children:[/*#__PURE__*/_jsxs(Button,{type:\"submit\",onClick:e=>{e.preventDefault();handleSubmit(e);},disabled:loading.submit||Object.keys(errors).length>0,className:\"h-11\",children:[loading.submit?/*#__PURE__*/_jsx(Loader2,{className:\"mr-2 h-4 w-4 animate-spin\"}):/*#__PURE__*/_jsx(Save,{className:\"mr-2 h-4 w-4\"}),editingActivityId?'Actualizar':'Guardar']}),editingActivityId&&/*#__PURE__*/_jsxs(Button,{type:\"button\",variant:\"outline\",onClick:resetForm,className:\"h-11\",children:[/*#__PURE__*/_jsx(XCircle,{className:\"mr-2 h-4 w-4\"}),\" Cancelar edici\\xF3n\"]})]})]})]})}),/*#__PURE__*/_jsx(\"aside\",{className:\"lg:col-span-2\",children:/*#__PURE__*/_jsxs(Card,{className:\"h-full text-wrap\",children:[/*#__PURE__*/_jsxs(CardHeader,{className:\"relative\",children:[/*#__PURE__*/_jsxs(CardTitle,{className:\"text-center flex items-center justify-center gap-2\",children:[/*#__PURE__*/_jsx(ClipboardList,{className:\"h-5 w-5\"}),\"Actividades del D\\xEDa\"]}),/*#__PURE__*/_jsxs(Dialog,{open:isHoveringTableButton,onOpenChange:setIsHoveringTableButton,children:[/*#__PURE__*/_jsx(Button,{type:\"button\",variant:\"outline\",size:\"icon\",title:\"Ver tabla de horas\",className:\"absolute right-4 top-4\",onMouseEnter:()=>setIsHoveringTableButton(true),children:/*#__PURE__*/_jsx(Clock,{className:\"h-4 w-4\"})}),/*#__PURE__*/_jsxs(DialogContent,{className:\"max-w-4xl max-h-[90vh] overflow-y-auto\",children:[/*#__PURE__*/_jsxs(DialogHeader,{children:[/*#__PURE__*/_jsx(DialogTitle,{children:\"Reporte de Horas\"}),/*#__PURE__*/_jsx(DialogDescription,{children:\"Visualiza el reporte de horas registradas por mes.\"})]}),/*#__PURE__*/_jsx(TablaHoras,{})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-sm text-muted-foreground flex items-center justify-center gap-3 mt-2\",children:[/*#__PURE__*/_jsxs(\"span\",{className:\"inline-flex items-center gap-2\",children:[/*#__PURE__*/_jsx(CalendarIcon,{className:\"h-4 w-4\"}),\" \",format(selectedDate,'PPP',{locale:es})]}),/*#__PURE__*/_jsxs(\"span\",{className:\"inline-flex items-center px-2 py-0.5 rounded-full bg-muted/60 text-foreground/80\",children:[\"Total registros: \",dailyActivities.length]})]})]}),/*#__PURE__*/_jsx(CardContent,{children:loading.dailyActivities?/*#__PURE__*/_jsx(ActivityListSkeleton,{}):visibleActivities.length>0?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"space-y-4 max-h-[520px] overflow-y-auto overflow-x-hidden pr-1 text-wrap\",children:visibleActivities.map(activity=>/*#__PURE__*/_jsx(\"div\",{className:\"text-wrap\",children:/*#__PURE__*/_jsx(ActivityItem,{activity:activity,onEdit:handleEditActivity,onDelete:handleDelete})},activity.id))}),/*#__PURE__*/_jsx(\"div\",{className:\"pt-3\",children:/*#__PURE__*/_jsx(TotalHoursProgress,{totalHours:totalHoursToday,selectedDate:selectedDate})})]}):/*#__PURE__*/_jsx(EmptyState,{})})]})})]})}),undoData&&/*#__PURE__*/_jsxs(\"div\",{className:\"fixed bottom-3 left-1/2 -translate-x-1/2 z-50 bg-red-50 border border-red-200 text-red-700 shadow rounded-full px-4 py-2 flex items-center gap-3\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-sm\",children:\"Registro eliminado.\"}),/*#__PURE__*/_jsxs(Button,{size:\"sm\",variant:\"outline\",onClick:handleUndoDelete,children:[/*#__PURE__*/_jsx(Undo2,{className:\"h-4 w-4 mr-1\"}),\" Deshacer\"]})]})]});};export default FormularioHoras;","map":{"version":3,"names":["React","useState","useEffect","useCallback","useMemo","useRef","format","parseISO","es","Header","toast","Toaster","Calendar","CalendarIcon","Briefcase","Save","Pencil","ListChecks","ClipboardList","XCircle","PlusCircle","Loader2","Folder","Star","Minus","Plus","Info","Undo2","Clock","Card","CardContent","CardHeader","CardTitle","Button","Input","Popover","PopoverContent","PopoverTrigger","cn","Dialog","DialogContent","DialogHeader","DialogTitle","DialogDescription","FormSelect","ActivityItem","ActivityListSkeleton","EmptyState","TotalHoursProgress","TablaHoras","submitHours","getProjects","getProjectStages","getDisciplinesByStage","getActivitiesByDiscipline","getDailyActivities","deleteHour","updateHour","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","initialFormData","employeeId","employee_id","String","project_code","phase","discipline","activity","hours","note","DRAFT_KEY","sortAZ","arr","sort","a","b","localeCompare","numeric","sensitivity","projectComparator","_a$code","_b$code","aCode","code","trim","bCode","aStartsWithLetter","test","bStartsWithLetter","FormularioHoras","_ref","onSuccess","employeeName","onLogout","onShowPowerBI","formData","setFormData","selectedDate","setSelectedDate","Date","dailyActivities","setDailyActivities","projects","setProjects","stages","setStages","disciplines","setDisciplines","activities","setActivities","editingActivityId","setEditingActivityId","FAV_KEY","concat","favorites","setFavorites","sortDir","setSortDir","isTableModalOpen","setIsTableModalOpen","isTableVisible","setIsTableVisible","isHoveringTableButton","setIsHoveringTableButton","isDirty","setIsDirty","loading","setLoading","submit","delete","hoursInputRef","undoTimerRef","favScrollRef","handleFavWheel","e","Math","abs","deltaY","deltaX","preventDefault","stopPropagation","currentTarget","scrollLeft","selectedProjectName","_projects$find","find","p","name","hoursNumber","_formData$hours","raw","replace","n","Number","isFinite","totalHoursToday","reduce","sum","errors","setErrors","newErrors","localStorage","getItem","draft","JSON","parse","draftWithoutProjectCode","_objectWithoutProperties","_excluded","prev","_objectSpread","_unused","setItem","stringify","_unused2","saveFavorites","next","currentFavObj","isCurrentFavorite","some","f","toggleFavorite","error","filter","message","success","visibleActivities","list","id","reverse","base","changed","undefined","Boolean","refreshDailyActivities","date","dateString","acts","console","fetchProjects","data","sorted","fetchStages","projectCode","cleaned","v","map","fetchDisciplines","stage","fetchActivities","applyFavorite","fav","st","includes","ds","ac","handleDateChange","handleChange","value","target","handleNoteKeyDown","key","shiftKey","handleSelectChange","updated","resetForm","handleEditActivity","_activity$hours","d","_unused3","window","scrollTo","top","behavior","undoData","setUndoData","triggerUndoBanner","current","clearTimeout","setTimeout","handleUndoDelete","coreSubmit","submissionData","toastId","duration","handleSubmit","Object","keys","length","ok","handleDelete","adjustHours","delta","max","round","onKey","ctrlKey","metaKey","toLowerCase","addEventListener","removeEventListener","handleNavigateToPermissions","handleNavigateToHours","className","children","position","richColors","onNavigateToHours","onNavigateToPermissions","currentView","asChild","variant","locale","align","mode","selected","onSelect","initialFocus","label","onValueChange","options","dropdownLabel","placeholder","disabled","icon","required","readOnly","s","htmlFor","type","size","onClick","onChange","min","step","ref","title","onWheel","style","overscrollBehaviorX","overscrollBehaviorY","touchAction","idx","onKeyDown","rows","open","onOpenChange","onMouseEnter","onEdit","onDelete","totalHours"],"sources":["D:/formulario de horas/FormularioHoras Version 1/frontend/src/components/FormularioHoras.tsx"],"sourcesContent":["// FormularioHoras.tsx\r\n\r\n/// <reference types=\"react\" />\r\n/// <reference types=\"react-dom\" />\r\nimport React, { useState, useEffect, useCallback, useMemo, useRef } from 'react';\r\nimport { format, parseISO } from 'date-fns';\r\nimport { es } from 'date-fns/locale';\r\nimport Header from './Header';\r\n\r\nimport { toast, Toaster } from 'sonner';\r\nimport {\r\n  Calendar as CalendarIcon,\r\n  Briefcase,\r\n  Save,\r\n  Pencil,\r\n  ListChecks,\r\n  ClipboardList,\r\n  XCircle,\r\n  PlusCircle,\r\n  Loader2,\r\n  Folder,\r\n  Star,\r\n  ArrowUpDown,\r\n  Minus,\r\n  Plus,\r\n  Info,\r\n  Undo2,\r\n  Clock,\r\n  BarChart2,\r\n} from 'lucide-react';\r\n\r\nimport { Card, CardContent, CardHeader, CardTitle } from './ui/card';\r\nimport { Button } from './ui/button';\r\nimport { Input } from './ui/input';\r\nimport { Calendar } from './ui/calendar';\r\nimport { Popover, PopoverContent, PopoverTrigger } from './ui/popover';\r\nimport { Tabs, TabsList, TabsTrigger, TabsContent } from './ui/tabs';\r\nimport { cn } from '../lib/utils';\r\nimport { Dialog, DialogContent, DialogTrigger, DialogHeader, DialogTitle, DialogDescription } from './ui/dialog';\r\n\r\nimport { FormSelect } from './formulario/FormSelect';\r\nimport { ActivityItem } from './formulario/ActivityItem';\r\nimport { ActivityListSkeleton } from './formulario/ActivityListSkeleton';\r\nimport { EmptyState } from './formulario/EmptyState';\r\nimport { TotalHoursProgress } from './formulario/TotalHoursProgress';\r\nimport TablaHoras from './TablaHoras';\r\n\r\nimport {\r\n  submitHours,\r\n  getProjects,\r\n  getProjectStages,\r\n  getDisciplinesByStage,\r\n  getActivitiesByDiscipline,\r\n  getDailyActivities,\r\n  deleteHour,\r\n  updateHour,\r\n  type DailyActivity,\r\n} from '../api/horasApi';\r\n\r\n// Props e interfaces\r\ninterface FormularioHorasProps {\r\n  onSuccess: () => void;\r\n  employeeId: number;\r\n  employeeName: string;\r\n  onLogout: () => void;\r\n  onShowPowerBI: () => void;\r\n  onNavigateToHours: () => void;\r\n  onNavigateToPermissions: () => void;\r\n}\r\n\r\ninterface Project { code: string; name: string }\r\n\r\ntype Activity = DailyActivity;\r\n\r\nconst initialFormData = (employeeId: number) => ({\r\n  employee_id: String(employeeId),\r\n  project_code: '',\r\n  phase: '',\r\n  discipline: '',\r\n  activity: '',\r\n  hours: '0',\r\n  note: '',\r\n});\r\n\r\nconst DRAFT_KEY = 'fh_form_draft_v1';\r\n\r\n// Helper: ordenar A-Z / 0-9\r\nconst sortAZ = (arr: string[]) =>\r\n  [...arr].sort((a, b) => a.localeCompare(b, 'es', { numeric: true, sensitivity: 'base' }));\r\n\r\n// Comparator: primero letras, luego números\r\nconst projectComparator = (a: Project, b: Project) => {\r\n  const aCode = (a.code ?? '').trim();\r\n  const bCode = (b.code ?? '').trim();\r\n  const aStartsWithLetter = /^[A-Za-zÁÉÍÓÚÜÑ]/i.test(aCode);\r\n  const bStartsWithLetter = /^[A-Za-zÁÉÍÓÚÜÑ]/i.test(bCode);\r\n  if (aStartsWithLetter !== bStartsWithLetter) return aStartsWithLetter ? -1 : 1;\r\n  // dentro del mismo grupo, ordenar natural A-Z/0-9\r\n  return aCode.localeCompare(bCode, 'es', { numeric: true, sensitivity: 'base' });\r\n};\r\n\r\nconst FormularioHoras: React.FC<FormularioHorasProps> = ({ onSuccess, employeeId, employeeName, onLogout, onShowPowerBI }) => {\r\n  const [formData, setFormData] = useState(initialFormData(employeeId));\r\n  const [selectedDate, setSelectedDate] = useState(new Date());\r\n  const [dailyActivities, setDailyActivities] = useState<Activity[]>([]);\r\n  const [projects, setProjects] = useState<Project[]>([]);\r\n  const [stages, setStages] = useState<string[]>([]);\r\n  const [disciplines, setDisciplines] = useState<string[]>([]);\r\n  const [activities, setActivities] = useState<string[]>([]);\r\n  const [editingActivityId, setEditingActivityId] = useState<string | null>(null);\r\n\r\n  type Favorite = { project_code: string; phase: string; discipline: string; activity: string };\r\n  const FAV_KEY = useMemo(() => `fh_favorites_v1_${employeeId}`, [employeeId]);\r\n  const [favorites, setFavorites] = useState<Favorite[]>([]);\r\n\r\n  const [sortDir, setSortDir] = useState<'asc' | 'desc'>('asc');\r\n  const [isTableModalOpen, setIsTableModalOpen] = useState<boolean>(false);\r\n  const [isTableVisible, setIsTableVisible] = useState<boolean>(false);\r\n  const [isHoveringTableButton, setIsHoveringTableButton] = useState<boolean>(false);\r\n  const [isDirty, setIsDirty] = useState<boolean>(false);\r\n  const [loading, setLoading] = useState({\r\n    submit: false,\r\n    projects: true,\r\n    stages: false,\r\n    disciplines: false,\r\n    activities: false,\r\n    dailyActivities: true,\r\n    delete: null as string | null,\r\n  });\r\n\r\n  const hoursInputRef = useRef<HTMLInputElement | null>(null);\r\n  const undoTimerRef = useRef<NodeJS.Timeout | null>(null);\r\n  const favScrollRef = useRef<HTMLDivElement | null>(null);\r\n  const handleFavWheel = useCallback((e: React.WheelEvent<HTMLDivElement>) => {\r\n    if (Math.abs(e.deltaY) > Math.abs(e.deltaX)) {\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n      e.currentTarget.scrollLeft += e.deltaY;\r\n    }\r\n  }, []);\r\n\r\n  const selectedProjectName = useMemo(\r\n    () => projects.find(p => p.code === formData.project_code)?.name || '',\r\n    [formData.project_code, projects]\r\n  );\r\n  const hoursNumber = useMemo(() => {\r\n    const raw = String(formData.hours ?? '').replace(',', '.').trim();\r\n    const n = Number(raw);\r\n    return Number.isFinite(n) ? n : 0;\r\n  }, [formData.hours]);\r\n  const totalHoursToday = useMemo(\r\n    () => dailyActivities.reduce((sum, a) => sum + (Number(a.hours) || 0), 0),\r\n    [dailyActivities]\r\n  );\r\n\r\n  const [errors, setErrors] = useState<Partial<Record<keyof ReturnType<typeof initialFormData>, string>>>({});\r\n  useEffect(() => {\r\n    const newErrors: typeof errors = {};\r\n    if (!formData.project_code) newErrors.project_code = 'Selecciona un proyecto';\r\n    if (!formData.phase) newErrors.phase = 'Selecciona una etapa';\r\n    if (!formData.discipline) newErrors.discipline = 'Selecciona una disciplina';\r\n    if (!formData.activity) newErrors.activity = 'Selecciona una actividad';\r\n    if (!(hoursNumber > 0)) newErrors.hours = 'Ingresa horas válidas (> 0)';\r\n    setErrors(newErrors);\r\n  }, [formData, hoursNumber]);\r\n\r\n  useEffect(() => {\r\n    const raw = localStorage.getItem(DRAFT_KEY);\r\n    if (raw) { try {\r\n      const draft = JSON.parse(raw);\r\n      // Restore form data but keep project_code empty to ensure it's cleared on page refresh\r\n      const { project_code, ...draftWithoutProjectCode } = draft;\r\n      setFormData((prev) => ({\r\n        ...prev,\r\n        ...draftWithoutProjectCode,\r\n        project_code: '', // Always initialize project_code as empty\r\n        employee_id: String(employeeId)\r\n      }));\r\n    } catch {} }\r\n  }, [employeeId]);\r\n  useEffect(() => { localStorage.setItem(DRAFT_KEY, JSON.stringify(formData)); }, [formData]);\r\n\r\n  useEffect(() => {\r\n    const raw = localStorage.getItem(FAV_KEY);\r\n    if (raw) try { setFavorites(JSON.parse(raw)); } catch {}\r\n  }, [FAV_KEY]);\r\n  const saveFavorites = (next: Favorite[]) => { setFavorites(next); localStorage.setItem(FAV_KEY, JSON.stringify(next)); };\r\n\r\n  const currentFavObj = useMemo(() => {\r\n    if (!formData.project_code || !formData.phase || !formData.discipline || !formData.activity) return null;\r\n    return { project_code: formData.project_code, phase: formData.phase, discipline: formData.discipline, activity: formData.activity } as Favorite;\r\n  }, [formData.project_code, formData.phase, formData.discipline, formData.activity]);\r\n  const isCurrentFavorite = useMemo(() => {\r\n    if (!currentFavObj) return false;\r\n    return favorites.some(f => JSON.stringify(f) === JSON.stringify(currentFavObj));\r\n  }, [favorites, currentFavObj]);\r\n\r\n  const toggleFavorite = () => {\r\n    if (!currentFavObj) { toast.error('Completa Proyecto, Etapa, Disciplina y Actividad para usar favoritos'); return; }\r\n    if (isCurrentFavorite) {\r\n      const next = favorites.filter(f => JSON.stringify(f) !== JSON.stringify(currentFavObj));\r\n      saveFavorites(next);\r\n      toast.message('Eliminado de favoritos');\r\n    } else {\r\n      saveFavorites([...favorites, currentFavObj]);\r\n      toast.success('Guardado en favoritos');\r\n    }\r\n  };\r\n\r\n  const visibleActivities = useMemo(() => {\r\n    let list = [...dailyActivities];\r\n    list.sort((a, b) => (a.id || '').localeCompare(b.id || ''));\r\n    if (sortDir === 'desc') list.reverse();\r\n    return list;\r\n  }, [dailyActivities, sortDir]);\r\n\r\n  useEffect(() => {\r\n    const base = initialFormData(employeeId);\r\n    const changed = JSON.stringify({ ...formData, employee_id: undefined }) !== JSON.stringify({ ...base, employee_id: undefined });\r\n    setIsDirty(changed || Boolean(editingActivityId));\r\n  }, [formData, editingActivityId, employeeId]);\r\n\r\n  const refreshDailyActivities = useCallback(async (date: Date, id: string) => {\r\n    setLoading((p) => ({ ...p, dailyActivities: true }));\r\n    try {\r\n      const dateString = format(date, 'yyyy-MM-dd');\r\n      const acts = await getDailyActivities(dateString, Number(id));\r\n      setDailyActivities(acts);\r\n    } catch (e) {\r\n      toast.error('Error al cargar las actividades del día.');\r\n      console.error(e);\r\n    } finally {\r\n      setLoading((p) => ({ ...p, dailyActivities: false }));\r\n    }\r\n  }, []);\r\n\r\n  const fetchProjects = useCallback(async () => {\r\n    setLoading((p) => ({ ...p, projects: true }));\r\n    try {\r\n      const data = await getProjects();\r\n      const sorted = [...data].sort(projectComparator); // letras primero, luego números\r\n      setProjects(sorted);\r\n    } catch (e) {\r\n      toast.error('Error al cargar proyectos.');\r\n    } finally {\r\n      setLoading((p) => ({ ...p, projects: false }));\r\n    }\r\n  }, []);\r\n\r\n  const fetchStages = useCallback(async (projectCode: string) => {\r\n    if (!projectCode) return [] as string[];\r\n    setLoading((p) => ({ ...p, stages: true }));\r\n    try {\r\n      const data = await getProjectStages(projectCode);\r\n      const cleaned = (data || []).filter((v: any) => v != null && String(v).trim() !== '').map(String);\r\n      const sorted = sortAZ(cleaned);\r\n      setStages(sorted);\r\n      return sorted;\r\n    } catch (e) {\r\n      toast.error('Error al cargar etapas.');\r\n      setStages([]);\r\n      return [];\r\n    } finally {\r\n      setLoading((p) => ({ ...p, stages: false }));\r\n    }\r\n  }, []);\r\n\r\n  const fetchDisciplines = useCallback(async (projectCode: string, stage: string) => {\r\n    if (!projectCode || !stage) return [] as string[];\r\n    setLoading((p) => ({ ...p, disciplines: true }));\r\n    try {\r\n      const data = await getDisciplinesByStage(projectCode, stage);\r\n      const cleaned = (data || []).filter((v: any) => v != null && String(v).trim() !== '').map(String);\r\n      const sorted = sortAZ(cleaned);\r\n      setDisciplines(sorted);\r\n      return sorted;\r\n    } catch (e) {\r\n      toast.error('Error al cargar disciplinas.');\r\n      setDisciplines([]);\r\n      return [];\r\n    } finally {\r\n      setLoading((p) => ({ ...p, disciplines: false }));\r\n    }\r\n  }, []);\r\n\r\n  const fetchActivities = useCallback(async (projectCode: string, stage: string, discipline: string) => {\r\n    if (!projectCode || !stage || !discipline) return [] as string[];\r\n    setLoading((p) => ({ ...p, activities: true }));\r\n    try {\r\n      const data = await getActivitiesByDiscipline(projectCode, stage, discipline);\r\n      const cleaned = (data || []).filter((v: any) => v != null && String(v).trim() !== '').map(String);\r\n      const sorted = sortAZ(cleaned);\r\n      setActivities(sorted);\r\n      return sorted;\r\n    } catch (e) {\r\n      toast.error('Error al cargar actividades.');\r\n      setActivities([]);\r\n      return [];\r\n    } finally {\r\n      setLoading((p) => ({ ...p, activities: false }));\r\n    }\r\n  }, []);\r\n\r\n  const applyFavorite = useCallback(async (fav: Favorite) => {\r\n    try {\r\n      setFormData((prev) => ({ ...prev, project_code: fav.project_code, phase: '', discipline: '', activity: '' }));\r\n      const st = await fetchStages(fav.project_code);\r\n      if (st && st.includes(fav.phase)) {\r\n        const ds = await fetchDisciplines(fav.project_code, fav.phase);\r\n        if (ds && ds.includes(fav.discipline)) {\r\n          const ac = await fetchActivities(fav.project_code, fav.phase, fav.discipline);\r\n          if (ac && ac.includes(fav.activity)) {\r\n            setFormData({\r\n              employee_id: String(employeeId),\r\n              project_code: fav.project_code,\r\n              phase: fav.phase,\r\n              discipline: fav.discipline,\r\n              activity: fav.activity,\r\n              hours: '0',\r\n              note: '',\r\n            });\r\n          }\r\n        }\r\n      }\r\n    } catch (e) {\r\n      console.error(e);\r\n      toast.error('No se pudo aplicar el favorito');\r\n    }\r\n  }, [employeeId, fetchStages, fetchDisciplines, fetchActivities]);\r\n\r\n  useEffect(() => { fetchProjects(); }, [fetchProjects]);\r\n  useEffect(() => { refreshDailyActivities(selectedDate, String(employeeId)); }, [selectedDate, employeeId, refreshDailyActivities]);\r\n\r\n  const handleDateChange = (date?: Date) => { if (date) setSelectedDate(date); };\r\n  const handleChange = (e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement>) => {\r\n    const { name, value } = e.target;\r\n    const v = name === 'hours' ? value.replace(',', '.') : value;\r\n    setFormData((prev) => ({ ...prev, [name]: v }));\r\n  };\r\n  const handleNoteKeyDown = (e: React.KeyboardEvent<HTMLTextAreaElement>) => { if (e.key === 'Enter' && !e.shiftKey) e.preventDefault(); };\r\n\r\n  const handleSelectChange = async (name: keyof ReturnType<typeof initialFormData>, value: string) => {\r\n    const updated = { ...formData, [name]: value } as ReturnType<typeof initialFormData>;\r\n    switch (name) {\r\n      case 'project_code':\r\n        updated.phase = ''; updated.discipline = ''; updated.activity = '';\r\n        setFormData(updated); setStages([]); setDisciplines([]); setActivities([]);\r\n        if (value) await fetchStages(value);\r\n        break;\r\n      case 'phase':\r\n        updated.discipline = ''; updated.activity = '';\r\n        setFormData(updated); setDisciplines([]); setActivities([]);\r\n        if (value && updated.project_code) await fetchDisciplines(updated.project_code, value);\r\n        break;\r\n      case 'discipline':\r\n        updated.activity = '';\r\n        setFormData(updated); setActivities([]);\r\n        if (value && updated.project_code && updated.phase) await fetchActivities(updated.project_code, updated.phase, value);\r\n        break;\r\n      default:\r\n        setFormData(updated);\r\n    }\r\n  };\r\n\r\n  const resetForm = useCallback(() => {\r\n    setFormData(initialFormData(employeeId));\r\n    setEditingActivityId(null);\r\n  }, [employeeId]);\r\n\r\n  const handleEditActivity = useCallback(async (activity: Activity) => {\r\n    try {\r\n      if (activity.date) {\r\n        try {\r\n          const d = typeof activity.date === 'string' ? parseISO(activity.date) : new Date(activity.date);\r\n          setSelectedDate(d);\r\n        } catch {}\r\n      }\r\n      if (activity.project_code) {\r\n        await fetchStages(activity.project_code);\r\n        if (activity.phase) await fetchDisciplines(activity.project_code, activity.phase);\r\n        if (activity.phase && activity.discipline) await fetchActivities(activity.project_code, activity.phase, activity.discipline);\r\n      }\r\n      setFormData({\r\n        employee_id: String(employeeId),\r\n        project_code: activity.project_code || '',\r\n        phase: activity.phase || '',\r\n        discipline: activity.discipline || '',\r\n        activity: activity.activity || '',\r\n        hours: String(activity.hours ?? '0'),\r\n        note: activity.note || '',\r\n      });\r\n      setEditingActivityId(String(activity.id));\r\n      window.scrollTo({ top: 0, behavior: 'smooth' });\r\n    } catch (e) {\r\n      console.error(e);\r\n      toast.error('Error al cargar la actividad para edición');\r\n    }\r\n  }, [employeeId, fetchStages, fetchDisciplines, fetchActivities]);\r\n\r\n  const [undoData, setUndoData] = useState<Activity | null>(null);\r\n  const triggerUndoBanner = (activity: Activity) => {\r\n    setUndoData(activity);\r\n    if (undoTimerRef.current) clearTimeout(undoTimerRef.current);\r\n    undoTimerRef.current = setTimeout(() => setUndoData(null), 8000);\r\n  };\r\n  const handleUndoDelete = async () => {\r\n    if (!undoData) return;\r\n    const a = undoData; setUndoData(null);\r\n    try {\r\n      await submitHours({\r\n        project_code: a.project_code,\r\n        phase: a.phase,\r\n        discipline: a.discipline,\r\n        activity: a.activity,\r\n        hours: a.hours,\r\n        note: a.note || '',\r\n        date: format(selectedDate, 'yyyy-MM-dd'),\r\n        employee_id: employeeId,\r\n      });\r\n      await refreshDailyActivities(selectedDate, String(employeeId));\r\n      toast.success('Registro restaurado');\r\n    } catch (e) {\r\n      toast.error('No se pudo restaurar');\r\n    }\r\n  };\r\n\r\n  const coreSubmit = async () => {\r\n    const submissionData = {\r\n      project_code: formData.project_code,\r\n      phase: formData.phase,\r\n      discipline: formData.discipline,\r\n      activity: formData.activity,\r\n      hours: hoursNumber,\r\n      note: formData.note || '',\r\n      date: format(selectedDate, 'yyyy-MM-dd'),\r\n      employee_id: employeeId,\r\n    };\r\n\r\n    const toastId = toast.loading(editingActivityId ? 'Actualizando actividad...' : 'Guardando actividad...');\r\n    setLoading((p) => ({ ...p, submit: true }));\r\n\r\n    try {\r\n      if (editingActivityId) { await updateHour(editingActivityId, submissionData); }\r\n      else { await submitHours(submissionData); }\r\n\r\n      toast.success(`Actividad ${editingActivityId ? 'actualizada' : 'guardada'} con éxito.`, { id: toastId, duration: 1800 });\r\n      await refreshDailyActivities(selectedDate, String(employeeId));\r\n      onSuccess?.();\r\n      return true;\r\n    } catch (e) {\r\n      console.error(e);\r\n      toast.error('Ocurrió un error al guardar.', { id: toastId });\r\n      return false;\r\n    } finally {\r\n      setLoading((p) => ({ ...p, submit: false }));\r\n    }\r\n  };\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    if (Object.keys(errors).length) { toast.error('Revisa los campos marcados'); return; }\r\n    const ok = await coreSubmit();\r\n    if (ok) resetForm();\r\n  };\r\n\r\n  const handleDelete = async (id: string) => {\r\n    const prev = dailyActivities.find(a => String(a.id) === String(id));\r\n    try {\r\n      setLoading(p => ({ ...p, delete: id }));\r\n      await deleteHour(id);\r\n      await refreshDailyActivities(selectedDate, String(employeeId));\r\n      if (prev) triggerUndoBanner(prev);\r\n      toast.error('Actividad eliminada');\r\n    } catch (e) {\r\n      console.error(e);\r\n      toast.error('No se pudo eliminar');\r\n    } finally {\r\n      setLoading(p => ({ ...p, delete: null }));\r\n    }\r\n  };\r\n\r\n  const adjustHours = (delta: number) => {\r\n    const current = hoursNumber || 0;\r\n    const next = Math.max(0, Math.round((current + delta) * 2) / 2);\r\n    setFormData((prev) => ({ ...prev, hours: String(next) }));\r\n  };\r\n\r\n  useEffect(() => {\r\n    const onKey = (e: KeyboardEvent) => {\r\n      if ((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === 'enter') {\r\n        e.preventDefault();\r\n        (async () => { if (!loading.submit) { const ok = await coreSubmit(); if (ok) resetForm(); } })();\r\n      }\r\n      if (e.key === 'Escape') { resetForm(); }\r\n    };\r\n    window.addEventListener('keydown', onKey);\r\n    return () => window.removeEventListener('keydown', onKey);\r\n  }, [coreSubmit, loading.submit, resetForm]);\r\n\r\n  // Navegar a la vista de permisos\r\n  const handleNavigateToPermissions = () => {\r\n    // La lógica de navegación se maneja en App.tsx\r\n  };\r\n\r\n  // Navegar a la vista de horas\r\n  const handleNavigateToHours = () => {\r\n    // La lógica de navegación se maneja en App.tsx\r\n  };\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-[#f2f6fd] text-foreground\">\r\n      <Toaster position=\"top-right\" richColors />\r\n      <Header\r\n        employeeName={employeeName}\r\n        onLogout={onLogout}\r\n        onShowPowerBI={onShowPowerBI}\r\n        onNavigateToHours={handleNavigateToHours}\r\n        onNavigateToPermissions={handleNavigateToPermissions}\r\n        currentView=\"hours\"\r\n      />\r\n\r\n      <style>{`\r\n        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }\r\n        .hide-scrollbar::-webkit-scrollbar { display: none; }\r\n        .fav-strip { overscroll-behavior-y: contain; touch-action: pan-x; }\r\n\r\n        /* 👉 Fuerza saltos de línea en textos sin espacios y evita desbordes */\r\n        .text-wrap, .text-wrap *{\r\n          overflow-wrap: anywhere;\r\n          word-break: break-word;\r\n          hyphens: auto;\r\n        }\r\n      `}</style>\r\n\r\n      <div className=\"mx-auto container p-4 sm:p-6 lg:p-8\">\r\n        <div className=\"grid grid-cols-1 lg:grid-cols-5 gap-8 items-start\">\r\n          {/* PRINCIPAL */}\r\n          <main className={cn('lg:col-span-3')}>\r\n            <Card className=\"relative z-10 flex flex-col text-wrap\">\r\n              <CardHeader className=\"relative items-center text-center\">\r\n                <div className=\"flex items-center justify-center gap-2\">\r\n                  {editingActivityId ? <Pencil className=\"h-5 w-5\" /> : <PlusCircle className=\"h-5 w-5\" />}\r\n                  <CardTitle className=\"text-center\">\r\n                    {editingActivityId ? 'Editar Actividad' : 'Registrar Actividad'}\r\n                  </CardTitle>\r\n                </div>\r\n                <div className=\"absolute right-4 top-4 text-xs\">\r\n                  {editingActivityId ? (\r\n                    <span className=\"px-2 py-1 rounded-full bg-amber-100 text-amber-800\">Editando</span>\r\n                  ) : (\r\n                    <span className=\"px-2 py-1 rounded-full bg-emerald-100 text-emerald-700\">Creando</span>\r\n                  )}\r\n                </div>\r\n                <p className=\"mt-2 text-sm text-muted-foreground\">\r\n                  Registra tus horas del día para el proyecto seleccionado.\r\n                </p>\r\n\r\n                <div className=\"mt-3 text-xs sm:text-sm text-foreground/80 flex-wrap justify-center gap-2\">\r\n                  <span className=\"inline-flex items-center gap-1 px-2 py-1 rounded-full bg-white border\">\r\n                    <Briefcase className=\"h-3.5 w-3.5\" /> {formData.project_code || '—'}\r\n                  </span>\r\n                  <span className=\"inline-flex items-center gap-1 px-2 py-1 rounded-full bg-white border\">\r\n                    <ListChecks className=\"h-3.5 w-3.5\" /> {formData.phase || '—'}\r\n                  </span>\r\n                  <span className=\"inline-flex items-center gap-1 px-2 py-1 rounded-full bg-white border\">\r\n                    <Pencil className=\"h-3.5 w-3.5\" /> {formData.discipline || '—'}\r\n                  </span>\r\n                  <span className=\"inline-flex items-center gap-1 px-2 py-1 rounded-full bg-white border\">\r\n                    <ClipboardList className=\"h-3.5 w-3.5\" /> {formData.activity || '—'}\r\n                  </span>\r\n                </div>\r\n              </CardHeader>\r\n\r\n              <CardContent>\r\n                {/* Fecha */}\r\n                <div className=\"mb-4 w-full sm:max-w-xs\">\r\n                  <label className=\"block text-sm font-medium text-foreground/80 mb-1\">\r\n                    <span className=\"inline-flex items-center gap-1\">\r\n                      <CalendarIcon className=\"h-4 w-4\" /> Fecha\r\n                    </span>\r\n                  </label>\r\n                  <Popover>\r\n                    <PopoverTrigger asChild>\r\n                      <Button variant=\"outline\" className={cn('w-full justify-start font-normal h-10', !selectedDate && 'text-muted-foreground')}>\r\n                        <span>{format(selectedDate, 'PPP', { locale: es })}</span>\r\n                      </Button>\r\n                    </PopoverTrigger>\r\n                    <PopoverContent className=\"w-auto p-0\" align=\"start\">\r\n                      <Calendar mode=\"single\" selected={selectedDate} onSelect={handleDateChange} initialFocus locale={es} />\r\n                    </PopoverContent>\r\n                  </Popover>\r\n                </div>\r\n\r\n                {/* GRID: columna izquierda más estrecha */}\r\n                <div className=\"grid grid-cols-1 md:grid-cols-[320px_minmax(0,1fr)] gap-6 items-start\">\r\n                  {/* Código de Proyecto (col izq) */}\r\n                  <div className=\"text-wrap\">\r\n                    <FormSelect\r\n                      label=\"Código de Proyecto\"\r\n                      name=\"project_code\"\r\n                      value={formData.project_code}\r\n                      onValueChange={handleSelectChange as any}\r\n                      options={projects.map((p) => ({ value: p.code, label: p.code, dropdownLabel: `${p.code} - ${p.name}` }))}\r\n                      placeholder=\"Seleccione un proyecto\"\r\n                      loading={loading.projects}\r\n                      disabled={loading.projects}\r\n                      icon={<Briefcase className=\"h-4 w-4\" />}\r\n                      required\r\n                    />\r\n                    <p className=\"mt-1 text-[12px] text-muted-foreground whitespace-nowrap overflow-hidden text-ellipsis leading-none\">\r\n                      Elige el proyecto para cargar los demas campos.\r\n                    </p>\r\n                  </div>\r\n\r\n                  {/* Nombre del Proyecto (col der) */}\r\n                  <div className=\"space-y-2 text-wrap\">\r\n                    <label className=\"block text-sm font-medium text-foreground/80 mb-1\">\r\n                      <span className=\"inline-flex items-center gap-1\"><Folder className=\"h-4 w-4\" /> Nombre del Proyecto</span>\r\n                    </label>\r\n                    <Input value={selectedProjectName} readOnly className=\"bg-muted/50\" aria-label=\"Nombre de proyecto seleccionado\" />\r\n                  </div>\r\n\r\n                  {/* Etapa (izq) */}\r\n                  <div className=\"text-wrap\">\r\n                    <FormSelect\r\n                      label=\"Etapa\"\r\n                      name=\"phase\"\r\n                      value={formData.phase}\r\n                      onValueChange={handleSelectChange as any}\r\n                      options={stages.map((s) => ({ value: s, label: s }))}\r\n                      placeholder=\"Seleccione una etapa\"\r\n                      loading={loading.stages}\r\n                      disabled={!formData.project_code || loading.stages}\r\n                      icon={<ListChecks className=\"h-4 w-4\" />}\r\n                      required\r\n                    />\r\n                    <p className=\"mt-1 text-xs text-muted-foreground\">Etapas disponibles para el proyecto elegido.</p>\r\n                  </div>\r\n\r\n                  {/* Disciplina (der) */}\r\n                  <div className=\"text-wrap\">\r\n                    <FormSelect\r\n                      label=\"Disciplina\"\r\n                      name=\"discipline\"\r\n                      value={formData.discipline}\r\n                      onValueChange={handleSelectChange as any}\r\n                      options={disciplines.map((d) => ({ value: d, label: d }))}\r\n                      placeholder=\"Seleccione una disciplina\"\r\n                      loading={loading.disciplines}\r\n                      disabled={!formData.phase || loading.disciplines}\r\n                      icon={<Pencil className=\"h-4 w-4\" />}\r\n                      required\r\n                    />\r\n                    <p className=\"mt-1 text-xs text-muted-foreground\">Se filtran según la etapa seleccionada.</p>\r\n                  </div>\r\n\r\n                  {/* Actividad (izq) */}\r\n                  <div className=\"w-full md:w-[320px] text-wrap\">\r\n                    <FormSelect\r\n                      label=\"Actividad\"\r\n                      name=\"activity\"\r\n                      value={formData.activity}\r\n                      onValueChange={handleSelectChange as any}\r\n                      options={activities.map((a) => ({ value: a, label: a }))}\r\n                      placeholder=\"Seleccione una actividad\"\r\n                      loading={loading.activities}\r\n                      disabled={!formData.discipline || loading.activities}\r\n                      icon={<ClipboardList className=\"h-4 w-4\" />}\r\n                      required\r\n                    />\r\n                  </div>\r\n\r\n                  {/* Horas (der) – input a la izquierda, botones a la derecha */}\r\n                  <div className=\"flex flex-col text-wrap\">\r\n                    <label htmlFor=\"hours\" className=\"block text-sm font-medium text-foreground/80 mb-1\">\r\n                      <span className=\"inline-flex items-center gap-1\">\r\n                        <Clock className=\"h-4 w-4\" /> Horas <span className=\"text-destructive\">*</span>\r\n                      </span>\r\n                    </label>\r\n\r\n                    <div className=\"flex items-center gap-1\">\r\n                      {/* Botón Restar */}\r\n                      <Button\r\n                        type=\"button\"\r\n                        variant=\"outline\"\r\n                        size=\"icon\"\r\n                        className=\"h-10 w-10 shrink-0\"\r\n                        onClick={() => adjustHours(-0.5)}\r\n                        aria-label=\"Restar 0.5h\"\r\n                      >\r\n                        <Minus className=\"h-4 w-4\" />\r\n                      </Button>\r\n\r\n                      {/* Botón Sumar */}\r\n                      <Button\r\n                        type=\"button\"\r\n                        variant=\"outline\"\r\n                        size=\"icon\"\r\n                        className=\"h-10 w-10 shrink-0\"\r\n                        onClick={() => adjustHours(0.5)}\r\n                        aria-label=\"Sumar 0.5h\"\r\n                      >\r\n                        <Plus className=\"h-4 w-4\" />\r\n                      </Button>\r\n\r\n                      {/* Input de horas */}\r\n                      <Input\r\n                        id=\"hours\"\r\n                        name=\"hours\"\r\n                        type=\"number\"\r\n                        value={formData.hours}\r\n                        onChange={handleChange}\r\n                        min=\"0\"\r\n                        step=\"0.5\"\r\n                        ref={hoursInputRef}\r\n                        className=\"h-10 w-[100px] shrink-0 rounded-md mr-0\"\r\n                      />\r\n\r\n                      {/* Botón Favorito */}\r\n                      <Button\r\n                        type=\"button\"\r\n                        variant={isCurrentFavorite ? 'default' : 'outline'}\r\n                        className=\"h-10 shrink-0\"\r\n                        onClick={toggleFavorite}\r\n                        title={isCurrentFavorite ? 'Quitar de favoritos' : 'Guardar como favorito'}\r\n                      >\r\n                        <Star className=\"h-4 w-4 mr-2\" /> Favorito\r\n                      </Button>\r\n                    </div>\r\n                  </div>\r\n\r\n                  {/* Chips de favoritos (ocupa ambas columnas) */}\r\n                  {favorites.length > 0 && (\r\n                    <div className=\"md:col-span-2\">\r\n                      <div\r\n                        ref={favScrollRef}\r\n                        onWheel={handleFavWheel}\r\n                        className=\"mt-1 overflow-x-auto whitespace-nowrap hide-scrollbar fav-strip\"\r\n                        style={{ overscrollBehaviorX: 'contain', overscrollBehaviorY: 'none', touchAction: 'pan-x' }}\r\n                      >\r\n                        <div className=\"flex gap-2\">\r\n                          {favorites.map((fav, idx) => (\r\n                            <button\r\n                              key={idx}\r\n                              type=\"button\"\r\n                              onClick={() => applyFavorite(fav)}\r\n                              className=\"inline-flex items-center gap-2 px-3 py-1 rounded-full border bg-white hover:bg-muted text-xs shrink-0\"\r\n                              title={`${fav.project_code} • ${fav.phase} • ${fav.discipline}`}\r\n                            >\r\n                              <Star className=\"h-3.5 w-3.5\" />\r\n                              <span className=\"font-medium\">{fav.activity}</span>\r\n                            </button>\r\n                          ))}\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  )}\r\n\r\n                  {/* Nota (Opcional) – 2 líneas */}\r\n                  <div className=\"md:col-span-2 w-full text-wrap\">\r\n                    <label htmlFor=\"note\" className=\"block text-sm font-medium text-foreground/80 mb-1\">\r\n                      <span className=\"inline-flex items-center gap-1\">\r\n                        <Info className=\"h-4 w-4\" /> Nota (Opcional)\r\n                      </span>\r\n                    </label>\r\n                    <textarea\r\n                      id=\"note\"\r\n                      name=\"note\"\r\n                      value={formData.note}\r\n                      onChange={handleChange}\r\n                      onKeyDown={handleNoteKeyDown}\r\n                      rows={2}\r\n                      className=\"flex h-19 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 whitespace-pre-wrap\"\r\n                      placeholder=\"Descripción breve del trabajo realizado\"\r\n                    />\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Acciones */}\r\n                <div className=\"mt-6 flex items-center justify-end gap-3\">\r\n                  <Button\r\n                    type=\"submit\"\r\n                    onClick={(e) => { e.preventDefault(); handleSubmit(e as any); }}\r\n                    disabled={loading.submit || Object.keys(errors).length > 0}\r\n                    className=\"h-11\"\r\n                  >\r\n                    {loading.submit ? <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" /> : <Save className=\"mr-2 h-4 w-4\" />}\r\n                    {editingActivityId ? 'Actualizar' : 'Guardar'}\r\n                  </Button>\r\n\r\n                  {editingActivityId && (\r\n                    <Button type=\"button\" variant=\"outline\" onClick={resetForm} className=\"h-11\">\r\n                      <XCircle className=\"mr-2 h-4 w-4\" /> Cancelar edición\r\n                    </Button>\r\n                  )}\r\n                </div>\r\n              </CardContent>\r\n            </Card>\r\n          </main>\r\n\r\n          {/* LATERAL */}\r\n          <aside className=\"lg:col-span-2\">\r\n            <Card className=\"h-full text-wrap\">\r\n              <CardHeader className=\"relative\">\r\n                <CardTitle className=\"text-center flex items-center justify-center gap-2\">\r\n                  <ClipboardList className=\"h-5 w-5\" />\r\n                  Actividades del Día\r\n                </CardTitle>\r\n                {/* Dialog to show table on hover */}\r\n                <Dialog open={isHoveringTableButton} onOpenChange={setIsHoveringTableButton}>\r\n                  {/* Button to show table on hover */}\r\n                  <Button\r\n                    type=\"button\"\r\n                    variant=\"outline\"\r\n                    size=\"icon\"\r\n                    title=\"Ver tabla de horas\"\r\n                    className=\"absolute right-4 top-4\"\r\n                    onMouseEnter={() => setIsHoveringTableButton(true)}\r\n\r\n                    \r\n                  >\r\n                    <Clock className=\"h-4 w-4\" />\r\n                  </Button>\r\n                  <DialogContent className=\"max-w-4xl max-h-[90vh] overflow-y-auto\">\r\n                    <DialogHeader>\r\n                      <DialogTitle>Reporte de Horas</DialogTitle>\r\n                      <DialogDescription>\r\n                        Visualiza el reporte de horas registradas por mes.\r\n                      </DialogDescription>\r\n                    </DialogHeader>\r\n                    <TablaHoras />\r\n                  </DialogContent>\r\n                </Dialog>\r\n\r\n                <div className=\"text-sm text-muted-foreground flex items-center justify-center gap-3 mt-2\">\r\n                  <span className=\"inline-flex items-center gap-2\">\r\n                    <CalendarIcon className=\"h-4 w-4\" /> {format(selectedDate, 'PPP', { locale: es })}\r\n                  </span>\r\n                  <span className=\"inline-flex items-center px-2 py-0.5 rounded-full bg-muted/60 text-foreground/80\">\r\n                    Total registros: {dailyActivities.length}\r\n                  </span>\r\n                </div>\r\n              </CardHeader>\r\n\r\n              <CardContent>\r\n                {loading.dailyActivities ? (\r\n                  <ActivityListSkeleton />\r\n                ) : visibleActivities.length > 0 ? (\r\n                  <>\r\n                    {/* Lista sin overflow horizontal y con saltos de línea */}\r\n                    <div className=\"space-y-4 max-h-[520px] overflow-y-auto overflow-x-hidden pr-1 text-wrap\">\r\n                      {visibleActivities.map((activity) => (\r\n                        <div key={activity.id} className=\"text-wrap\">\r\n                          <ActivityItem\r\n                            activity={activity}\r\n                            onEdit={handleEditActivity}\r\n                            onDelete={handleDelete}\r\n                          />\r\n                        </div>\r\n                      ))}\r\n                    </div>\r\n                    <div className=\"pt-3\">\r\n                      <TotalHoursProgress totalHours={totalHoursToday} selectedDate={selectedDate} />\r\n                    </div>\r\n                  </>\r\n                ) : (\r\n                  <EmptyState />\r\n                )}\r\n              </CardContent>\r\n            </Card>\r\n          </aside>\r\n        </div>\r\n\r\n      </div>\r\n\r\n  {undoData && (\r\n    <div className=\"fixed bottom-3 left-1/2 -translate-x-1/2 z-50 bg-red-50 border border-red-200 text-red-700 shadow rounded-full px-4 py-2 flex items-center gap-3\">\r\n      <span className=\"text-sm\">Registro eliminado.</span>\r\n      <Button size=\"sm\" variant=\"outline\" onClick={handleUndoDelete}>\r\n        <Undo2 className=\"h-4 w-4 mr-1\" /> Deshacer\r\n      </Button>\r\n    </div>\r\n  )}\r\n</div>\r\n);\r\n};\r\n\r\nexport default FormularioHoras;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}